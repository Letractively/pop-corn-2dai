<?xml version="1.0" encoding="UTF-8"?>
<flow xmlns="http://www.springframework.org/schema/webflow"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:faces="http://www.springframework.org/schema/faces"
	xsi:schemaLocation="http://www.springframework.org/schema/webflow
        http://www.springframework.org/schema/webflow/spring-webflow-2.0.xsd"
	start-state="quedadaForm" parent="parent-flow">

  <input name="quedada" />

    <view-state id="quedadaForm" view="quedadaAdminMain.xhtml">
        <transition on="grabarQuedada" to="guardarQuedada"/>            

        <transition on="crearQuedada">
            <evaluate expression="quedadaController.crearQuedada(flowRequestContext)" result="flowScope.quedada" />
        </transition>
        <transition on="cancelarQuedada" to="cancelarQuedada"/>

        <transition on="borrarQuedada" to="borrarQuedada"/>

         
    </view-state>

    <action-state id="guardarQuedada">
        
        <evaluate expression="quedadaController.grabarQuedada(quedada,flowRequestContext)" />
        
        <transition to="quedadaFechasForm"/>
    </action-state>



    <view-state id="quedadaFechasForm" view="quedadaAdminFechas.xhtml">
        <on-render>
            
            <evaluate expression="fechasController.getFechas(quedada)" result="flowScope.fechas" />
        </on-render>
        <transition on="quedadaMainForm" to="quedadaForm"/>
        <transition on="addFecha" >
            <evaluate expression="fechasController.addFecha(quedada,flowRequestContext)" />
        </transition>
        <transition on="borrarFecha" >
            <evaluate expression="fechasController.borrarFecha(quedada,flowRequestContext)" />
        </transition>
    </view-state>
    
    <action-state id="cancelarQuedada">
        
        <evaluate expression="quedadaController.cancelarQuedada(flowRequestContext)"/>
        <evaluate expression="messageContext.addMessage(xx.getMessage())"/>
        
        <transition to="end"/>
    </action-state>


    <action-state id="borrarQuedada">

        <evaluate expression="quedadaController.borrarQuedada(quedada, flowRequestContext)"/>

        <transition to="end"/>
    </action-state>



</flow>
